<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>斯坦福CS193p作业之Smashtag | 黄琨的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="环境：iOS 8, Swift作业：Programming_ Project 4.pdf (Assignment 4)资源：vojtamolda&#x2F;cs193p 作业要求 用不同颜色来标记不同的标签、url和用户名（凡是具有提示性的信息）。 &#x2F;&#x2F; [IndexedKeyword] 当用户点击其中一个tweet的时候，segue到一个新的UITableViewController（以下我就称其为Men">
<meta name="keywords" content="ios,cs193p,swift">
<meta property="og:type" content="article">
<meta property="og:title" content="斯坦福CS193p作业之Smashtag">
<meta property="og:url" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;index.html">
<meta property="og:site_name" content="黄琨的博客">
<meta property="og:description" content="环境：iOS 8, Swift作业：Programming_ Project 4.pdf (Assignment 4)资源：vojtamolda&#x2F;cs193p 作业要求 用不同颜色来标记不同的标签、url和用户名（凡是具有提示性的信息）。 &#x2F;&#x2F; [IndexedKeyword] 当用户点击其中一个tweet的时候，segue到一个新的UITableViewController（以下我就称其为Men">
<meta property="og:locale" content="zh-cn">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;1.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;2.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;3.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;4.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;5.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;6.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;7.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;8.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;9.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;10.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;11.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;12.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;13.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;14.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;15.png">
<meta property="og:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;16.png">
<meta property="og:updated_time" content="2019-11-02T08:20:54.903Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;blog.skywander.cn&#x2F;cs193p-ios8-smashtag&#x2F;1.png">
  
    <link rel="alternate" href="/atom.xml" title="黄琨的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">黄琨的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">iOS开发</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.skywander.cn"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-cs193p-ios8-smashtag" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/cs193p-ios8-smashtag/" class="article-date">
  <time datetime="2015-03-08T10:19:26.000Z" itemprop="datePublished">2015-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      斯坦福CS193p作业之Smashtag
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>环境：iOS 8, Swift<br>作业：Programming_ Project 4.pdf (Assignment 4)<br>资源：<a href="https://github.com/vojtamolda/cs193p" target="_blank" rel="noopener">vojtamolda/cs193p</a></p>
<h2 id="作业要求"><a href="#作业要求" class="headerlink" title="作业要求"></a>作业要求</h2><ol>
<li>用不同颜色来标记不同的标签、url和用户名（凡是具有提示性的信息）。 // [IndexedKeyword]</li>
<li>当用户点击其中一个tweet的时候，segue到一个新的UITableViewController（以下我就称其为MentionsTableViewController），其中包含4个section来展示所有的提示性信息：比如图片、url、标签和用户名。图片要求是展现在首个section，并且每行只显示一个图片，其余三个就放在后面的三个section里面，也是每行展示一个信息。// tweet.media.url</li>
<li>上述的每个section都需要一个合适的header</li>
<li>如果该section没有信息可展示的话，那么就不需要header</li>
<li>如果用户点击标点或者用户名，就segue到一个新的vc显示搜索该标签或者该用户名的结果，注意搜索的标签是要带有前缀符号的，例如“#stanford”而不是“stanford”，搜索“@Jack”而不是“Jack”，而sugue到新的搜索结果展示vc必须与TweetTableViewController的展示效果一致。</li>
<li>如果用户在MentionsTableViewController中点击url的话，要求用Safari打开url</li>
<li>如果用户在MentionsTableViewController中点击一张图片的话，segue到一个新的专门可以放大缩小滚动图片的MVC，当首次加载该图片的时候，要求展示图片的原比例大小，而且周围没有“白边”。</li>
<li>在app中展示最新的100个twitter检索结果，加入一个UITabBarController，展示两个tap，一个是用来显示可以搜索的tableViewController，另一个用来显示最新搜索结果的tableViewController，对于最新的检索结果展示不能有重复且最近更新的展示在最上面。用户点击结果的话，就用segue展示相关的tweets。用NSUserDefaults储存最新的检索信息，这样的话当重启app的时候就可以直接显示了。</li>
<li>绝对不可以因为任何网络的请求而导致主线程受阻。</li>
<li>这是个iPhone-only的app，还要保证在portrait或者landscape都能正确展示信息。</li>
</ol>
<a id="more"></a>

<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><p>首先需要设置和开通VPN，毕竟在一般的途径下是无法访问twitter.com，具体的方法就不在这里介绍；然后在Programming_Project 4.pdf（Assignment 4）中点击链接“This set of Twitter utility classes”，下载斯坦福提供的Twitter.zip，或者在官网cs193p.stanford.edu也可以找到，下载后放入Smashtag项目中；最后还需要在真机或者simulator中进入设置-&gt;twitter-&gt;添加自己的twitter账号，因为该项目至建立在使用内置twitter账号的基础上进行的，最开始运行app的时候会弹出一个访问twitter账户的请求，选择允许，然后即可使用。如果出现账号等错误的话，会有出现一些控制台的打印信息以供参考。</p>
<img src="/cs193p-ios8-smashtag/1.png" class="">
<img src="/cs193p-ios8-smashtag/2.png" class="">

<h2 id="作业分析"><a href="#作业分析" class="headerlink" title="作业分析"></a>作业分析</h2><h4 id="如何用不同颜色区分带有提示的标签？例如-主页君-斯坦福"><a href="#如何用不同颜色区分带有提示的标签？例如-主页君-斯坦福" class="headerlink" title="如何用不同颜色区分带有提示的标签？例如@主页君, #斯坦福"></a>如何用不同颜色区分带有提示的标签？例如@主页君, #斯坦福</h4><p>方法一：</p>
<p>这些信息都可以通过斯坦福写好的tweet类来取得，比如@用户名就可以通过tweet.userMentions获得一个indexedkeyword数组，然后在通过其nsrange属性获得一个NSRange的取值（即该用户名在整个tweet.text里的范围值），然后创建NSMutableAttributedString，调用addAttribute(NSForegroundColorAttributeName, value: 自定义颜色, range: nsrange)，最后赋值给tweetTextLabel.attributedText</p>
<p>因为在这里我只需要nsrange，那么有一个简洁的方法将全部的userMentions数组转化为只含有nsrange的数组，那就是通过Array的map方法返回对数组中每个元素的修改！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let userMentionsNSRanges = tweet.userMentions.map &#123; $0.nsrange &#125;</span><br></pre></td></tr></table></figure>

<p>注意事项：不要忘记TweetTableViewCell在Storyboard中也设置过label.font属性，作为展示tweet内容的label，当然不提倡使用默认的system font，因此在demo中就已经从Storyboard中就设置了新的font，那么现在重新创建的NSMutableAttributedString可不要忘了之前已经设置好的其他属性哦。</p>
<img src="/cs193p-ios8-smashtag/3.png" class="">

<p>方法二：正则表达式（当作练手，值得一试）</p>
<p>这个可以说是通用的方法，比如建立检索@, # 或者http:// ＋中英文/数字 的NSRegularExpression，然后在enumerateMatchesInString()的closure中一样用NSMutableAttributedString处理结果。</p>
<p>注意事项：在swift中的enumerateMatchesInString()方法的closure中有三个参数，第一个是NSTextCheckingResult，在得到result的大括号中使用直接就crash掉了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; (result, flags, stop) in </span><br><span class="line">    let range = result.range // crash because range is nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果遇见上述因为nil而crash的话，那么加一层保护就好</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123; (result, flags, stop) in </span><br><span class="line">    if result != nil &#123;</span><br><span class="line">        let range = result.range // it works good</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我个人对于正则表达式的看法：在网上随处可见的很多别人写好的结果，比如检验url、email的表达式等，但是对于正则表达式没有入门的朋友来说，直接拿来用别人的成果对增加其概念的理解是没有一点帮助的，学习它更多的时候是为了要写出适合自己特殊需求的简单表达式，并且别人写好的也不见得就是十全十美，如果测出了bug，需要修改的话，又如何下手呢？在下面给出相关链接，真心推荐。提示：如果把写好的表达式直接放到Swift代码中一般都会出现解析问题，原因是Swift的String表达式中的\符号有特殊作用，不能直接作为普通字符使用，因此需要在前面添加\进行转义，比如\w+，就需要转成\w+才能正常使用。</p>
<ul>
<li><a href="http://deerchao.net/tutorials/regex/regex.htm" target="_blank" rel="noopener">正则表达式30分钟入门教程</a></li>
<li><a href="http://tool.oschina.net/regex?optionGlobl=global#" target="_blank" rel="noopener">在线测试</a></li>
</ul>
<h4 id="如何构建MentionsTableViewController"><a href="#如何构建MentionsTableViewController" class="headerlink" title="如何构建MentionsTableViewController"></a>如何构建MentionsTableViewController</h4><p>下图就是从TweetTableViewController选中一条tweet</p>
<img src="/cs193p-ios8-smashtag/4.png" class="">

<p>然后通过segue进入MentionsTableViewController</p>
<img src="/cs193p-ios8-smashtag/5.png" class="">

<p>既然每个section的具体数据都可以从tweet类中获得，那么在UITableViewDataSource中实现section的方法不就好了吗？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">override func tableView(tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int &#123;</span><br><span class="line">    switch section &#123;</span><br><span class="line">    case 0: return tweet.media.count // 第一个是图片section</span><br><span class="line">    case 1: return tweet.hashtags.count // 第二个是标签section</span><br><span class="line">    case 2: return tweet.userMentions.count // 第三个是提及的用户section</span><br><span class="line">    case 3: return tweet.urls.count // 第四个是链接section</span><br><span class="line">    default: return 0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">override func tableView(tableView: UITableView, titleForHeaderInSection section: Int) -&gt; String? &#123;</span><br><span class="line">    switch section &#123;</span><br><span class="line">    case: ...</span><br><span class="line">    case: ...</span><br><span class="line">    case: ...</span><br><span class="line">    case: ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现方法是没错的，可是呢，Paul教授却不建议这么干！！原因说是上面的分支语句太多了！！于是他在Assignment提示中就问到<strong>有没有一种数据结构能够封装上述的分支语句，最终简化成一行代码呢？</strong>看来真是不打开脑洞就过不了关了。根据Swift的enum特性，可以附带外加的参数。</p>
<p>创建一个专门负责TableViewSection的enum</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">enum TableViewDataSourceOragnizer &#123;</span><br><span class="line">    case Section(String?, [Any]) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的Section带有两个参数，第一个可以作为section header的title展示的在table中，可以是nil，第二个就是附带相关的数组数据，如果是图片section的话就附带一组图片url，如果是标签section的话，就附带一组indexedKeyword；</p>
<p>由于每个section的数据类型是不一致的，所以我选择用Any类型来包容一切，那为什么不用AnyObject呢？因为后面传进来的media和hashtags等数组都是struct非class类型，当然Any的包容心更宽广一些。</p>
<p>然后在首次加载收到tweet时候，创建四种section</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let mediaSection = TableViewDataSourceOragnizer.Section((tweet.media.count &gt; 0 ? &quot;Images&quot; : nil), tweet.media) // 这里会报错</span><br><span class="line"></span><br><span class="line">let hashtagSection = ...</span><br><span class="line"></span><br><span class="line">let userSection = ...</span><br><span class="line"></span><br><span class="line">let urlSection = ...</span><br></pre></td></tr></table></figure>

<p>上面创建4个section的时候会报错，比如编译器对图片section说”MediaItem”is not identical to Any! (What heck is that?!) 好吧，既然数组元素的类型不是Any就不让传入的话，那我就把该类型转化成Any</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">private extension Array &#123;</span><br><span class="line">    func typeWrapper() -&gt; [Any] &#123;</span><br><span class="line">        var wrapper = [Any]()</span><br><span class="line">        for elem in self &#123;</span><br><span class="line">            wrapper.append(elem)</span><br><span class="line">        &#125;</span><br><span class="line">        return wrapper</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后修改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let mediaSection = TableViewDataSourceOragnizer.Section((tweet.media.count &gt; 0 ? &quot;Images&quot; : nil), tweet.media.typeWrapper())</span><br></pre></td></tr></table></figure>

<p>在media后面加上.typeWrapper()方法，返回一个元素类型是Any的数组，这样编译器就停止了报怨。那么之后在实现cellForRowAtIndexPath的时候，需要检查Any的类型，然后转换成原版类型使用即可。</p>
<p>接着定义一个<code>sections</code>的属性把它们收集起来。注意该数组的index就是section的index，即最终按照图片、标签、提到用户、链接依此向下的section顺序进行展示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var sections = [TableViewDataSourceOragnizer]()</span><br><span class="line">sections = [mediaSection, hashtagSection, userSection, urlSection]</span><br></pre></td></tr></table></figure>

<p>然后重新实现TableViewDataSource</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">override func tableView(tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int &#123;</span><br><span class="line">    switch sections[section] &#123; case .Section(_, let contents): return contents.count &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">override func tableView(tableView: UITableView, titleForHeaderInSection section: Int) -&gt; String? &#123;</span><br><span class="line">    switch sections[section] &#123; case .Section(let sectionDescription, _): return sectionDescription &#125; // 如果是nil的话自然就没有header出现了</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>果然都是一行代码！我不知道这样实现算不算牵强，不过确实比之前的质量好很多。</p>
<p>注意事项：</p>
<p>在实现tableView的dataSource - cellForRowAtIndexPath的方法中有两点需要关注：</p>
<ol>
<li>由于图片的加载需要时间，所以把NSData(contentsOfURL:url)放在其他的线程中进行，保证UI畅通无阻；但是开始加载的时候，显示图片的cell会留给用户一个大空白，所以在等待加载的时候可以在cell中间放置一个转动的spinner，反馈一个正在加载的提示。</li>
<li>最终加载完成的图片的size要求是宽度与cell同宽，高度按原比例缩放。在MediaItem类中可以找到一个aspectRatio的属性，代表宽/高的值，通过他重新设置image的宽高，然后把resized image赋给imageView.image，那么问题来了：image.size的宽高原始比例不是自己也可以计算吗？为什么人家在API里设定这个属性？他的好处在于：在没有获得image的时候，首先知道image需要占用的宽高。因为image的获取是在其他线程中进行的，得到image的之前，table cell的高度已经是固定好的，得到的image以后发现也不能临时调整高度了，因此cell的高度需要在获取image之前预先按原比例设置正确的高度，等image加载结束后，直接放上去就行。那如何特别制定图片cell的高度呢？实现UITableViewDelegate方法heightForRowAtIndexPath()，找到针对图片cell的indexPath，返回合适的高度。最后需要注意aspectRatio这个属性是Double类型，所以计算cell高度的时候表达式中需要CGFloat(aspectRatio)进行转换，忘了的话，那明明正确的表达式为何给我报错呢？</li>
</ol>
<p>图片加载中</p>
<img src="/cs193p-ios8-smashtag/6.png" class="">

<p>图片加载后</p>
<img src="/cs193p-ios8-smashtag/7.png" class="">

<h4 id="如果转动到横屏，图片是否会正确显示呢？"><a href="#如果转动到横屏，图片是否会正确显示呢？" class="headerlink" title="如果转动到横屏，图片是否会正确显示呢？"></a>如果转动到横屏，图片是否会正确显示呢？</h4><p>到目前为止还没有很好的适配横屏后的图片，原因是显示图片的imageView只是在创建的时候设置了宽高，但是屏幕旋转后却没有及时调整，因此需要在每次转屏后及时响应才行。UITableViewDelegate方法中，heightForRowAtIndexPath()会在转屏的时候重新被调用，那么可以设计一个储存imageView的字典，比如[NSIdexPath:UIImageView]，在创建imageView的时候将其跟对应的indexPath绑定储存起来，然后在heightForRowAtIndexPath()的实现里，如果这个indexPath有对应的imageView，那就在这里重设imageView的宽高。（ps：创建这个字典还有个好处，由于tableCell都是时而出现时而消失的，如果当imageCell出了屏幕后又返回到屏幕之后，可以看看字典里是否储存了imageView，有的话就不用重新从网络中加载url了）</p>
<h4 id="如何点击cell后从Safari中打开链接？"><a href="#如何点击cell后从Safari中打开链接？" class="headerlink" title="如何点击cell后从Safari中打开链接？"></a>如何点击cell后从Safari中打开链接？</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UIApplication.sharedApplication().openURL(url)</span><br></pre></td></tr></table></figure>

<h4 id="如何处理ImageViewController的白边？"><a href="#如何处理ImageViewController的白边？" class="headerlink" title="如何处理ImageViewController的白边？"></a>如何处理ImageViewController的白边？</h4><p>首先问题来源于我在storyboard中创建一个UIViewController作为ImageViewController，用来展示image，然后添加一个UIScrollView，在scrollView中添加一个UIImageView，全部为拖拽非代码添加，然后设置autolayout，发现从document outline中如果从scrollView向上层的view发起leading和trailing constraints的时候，Xcode会设置成为-16</p>
<img src="/cs193p-ios8-smashtag/8.png" class="">

<p>为什么不是0呢？如果自行修改为0的话，就会出现一条白边。</p>
<img src="/cs193p-ios8-smashtag/9.png" class="">

<p>原来-16是说明Xcode认为当前view应该与superview留有一定的margin(空白边缘)，并以这个margin作为参照，所以在白边处为0，超过的部分设为负数。</p>
<img src="/cs193p-ios8-smashtag/10.png" class="">

<p>下面为修改步骤的截图，方法是把参照物从margin换成edge(边界)即可，即不要勾选Relative to Margin</p>
<img src="/cs193p-ios8-smashtag/11.png" class="">
<img src="/cs193p-ios8-smashtag/12.png" class="">
<img src="/cs193p-ios8-smashtag/13.png" class="">
<img src="/cs193p-ios8-smashtag/14.png" class="">

<p>这样就从白边（左）回到了正常（右）</p>
<img src="/cs193p-ios8-smashtag/15.png" class="">

<p>这个白边问题我是从stackoverflow.com找到的<a href="http://stackoverflow.com/questions/26447266/ios-autolayout-changes-leading-and-trailing-space" target="_blank" rel="noopener">解决方案</a></p>
<h4 id="对于ImageViewController，如何在转屏之后进行让大尺寸图片在scrollView中自动缩放以适合屏幕-autozooming-to-fit-screen-？"><a href="#对于ImageViewController，如何在转屏之后进行让大尺寸图片在scrollView中自动缩放以适合屏幕-autozooming-to-fit-screen-？" class="headerlink" title="对于ImageViewController，如何在转屏之后进行让大尺寸图片在scrollView中自动缩放以适合屏幕(autozooming-to-fit screen)？"></a>对于ImageViewController，如何在转屏之后进行让大尺寸图片在scrollView中自动缩放以适合屏幕(autozooming-to-fit screen)？</h4><p>运用UIScrollView中的zoomToRect()方法，自动zoom到给定的rect显示得到屏幕中，注意如果缩放后图片尺寸若小于屏幕尺寸的话，scrollView会默认把图片对齐到左上角，这通常不是我们想要的结果，因此还需要让图片居中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">override func viewDidLayoutSubviews() &#123;</span><br><span class="line">    super.viewDidLayoutSubviews()</span><br><span class="line">    scrollView.zoomToRect(imageView.frame, animated: true)</span><br><span class="line">    imageView.center = scrollView.center</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="如何一直segue下去？"><a href="#如何一直segue下去？" class="headerlink" title="如何一直segue下去？"></a>如何一直segue下去？</h4><p>根据要求，如果在MentionsTableViewController中用户点击标签cell，比如#photo或者@user，那么就要segue到一个新的TweetTableViewController并且搜索点击的信息。如果用户每次点击一个标签cell，每次都会push一个新的vc出来（当然你也可以尝试Unwind segue返回之前的vc然后执行搜索，这里选用一直push的方法），那么在storyboard已经有了TweetTableViewController和MentionsTableViewController，还要增加他们的克隆体吗？对于可以无限制的segue设计，用storyboard方式从Library进行增加式地拖拽和连线已经显得不现实了，所以需要通过代码showViewController(vc, sender:) 的方法进行push，但是push的对象呢？由于这两个主要的vc都是在storyboard中创建的，因此在代码中不能使用init创建，而是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let ttvc = storyboard!.instantiateViewControllerWithIdentifier(&quot;TweetTableViewController&quot;) as TweetTableViewController</span><br><span class="line"></span><br><span class="line">ttvc.searchText = cell.textLabel?.text</span><br></pre></td></tr></table></figure>

<p>顺便设置一个Storyboard ID （我的习惯是Storyboard ID名称与类名一致）</p>
<img src="/cs193p-ios8-smashtag/16.png" class="">

<p>需要注意的是代码中不要调用performSegueWithIdentifier()来进行代码segue，原因是任何传入到该方法的identifier必须在storyboard中有相应设置才可以，然后通过该语句触发storyboard中相应的segue；如果该方法在storyboard中找不到相应的segue，就会crash. </p>
<h4 id="如何从N多次push-segue后显示的vc中直接返回到rootViewController？"><a href="#如何从N多次push-segue后显示的vc中直接返回到rootViewController？" class="headerlink" title="如何从N多次push segue后显示的vc中直接返回到rootViewController？"></a>如何从N多次push segue后显示的vc中直接返回到rootViewController？</h4><p>在vc适当的地方添加一个UI，比如写着”Back to Root”的按钮，然后调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">navigationController?.popToRootViewControllerAnimated(true)</span><br></pre></td></tr></table></figure>

<p>最后如果你的vpn在项目中中断的话，如果连接上后再加载，却得到一个空表和一句控制台输出的话</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;TwitterRequest: No response from Twitter.&quot;</span><br></pre></td></tr></table></figure>

<p>这不是你的问题，建议更换一个iOS Simulator，运行就好了。所以至目前为止，我一直不停地切换与4s和5两个simulator，其中一个出了上述问题，更换另一个运行就好。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.skywander.cn/cs193p-ios8-smashtag/" data-id="ck2hbe6z5003ez1jb7tbid5un" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cs193p/" rel="tag">cs193p</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios/" rel="tag">ios</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swift/" rel="tag">swift</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/cs193p-ios8-breakout/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          斯坦福CS193p作业之打砖块
        
      </div>
    </a>
  
  
    <a href="/ios-certificate/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">iOS开发者证书的申请到安装（多图）</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Networking/" rel="tag">Networking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UICollectionView/" rel="tag">UICollectionView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cs193p/" rel="tag">cs193p</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/" rel="tag">ios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/objc/" rel="tag">objc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift/" rel="tag">swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xcode/" rel="tag">xcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E4%B9%A6/" rel="tag">读书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" rel="tag">项目总结</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Networking/" style="font-size: 10px;">Networking</a> <a href="/tags/UICollectionView/" style="font-size: 10px;">UICollectionView</a> <a href="/tags/cs193p/" style="font-size: 16px;">cs193p</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/ios/" style="font-size: 20px;">ios</a> <a href="/tags/mysql/" style="font-size: 12px;">mysql</a> <a href="/tags/objc/" style="font-size: 14px;">objc</a> <a href="/tags/swift/" style="font-size: 18px;">swift</a> <a href="/tags/web/" style="font-size: 12px;">web</a> <a href="/tags/xcode/" style="font-size: 10px;">xcode</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E8%AF%BB%E4%B9%A6/" style="font-size: 10px;">读书</a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" style="font-size: 12px;">项目总结</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">二月 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/Alamofire4/">Alamofire 4</a>
          </li>
        
          <li>
            <a href="/binary-search-for-UICollectionViewLayout/">使用二分搜索来提速UICollectionView</a>
          </li>
        
          <li>
            <a href="/UICollectionViewLeftAlignedFlexibleLayout/">通过中文布局来学习UICollectionViewLayout</a>
          </li>
        
          <li>
            <a href="/git-guru/">成为一名git大师</a>
          </li>
        
          <li>
            <a href="/ios-swizzling/">记一次方法交换崩溃的故事</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 黄琨(Jack Huang)<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>